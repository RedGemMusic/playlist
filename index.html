<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Library</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 20px;
            color: #fff;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
            color: #fff;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .info {
            margin-bottom: 15px;
            color: #888;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #fff;
            border-bottom: 2px solid #444;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
        }

        tbody tr:hover {
            background: #333;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Music Library</h1>
        
        <input 
            type="text" 
            class="search-box" 
            id="searchInput" 
            placeholder="Search by game, title, or length..."
        >
        
        <div class="info" id="info">Loading...</div>
        
        <table id="musicTable">
            <thead>
                <tr>
                    <th>Artist</th>
                    <th>Title</th>
                    <th>Length</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="3" class="loading">Loading music library...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        let musicData = [];
        let filteredData = [];

        // Load CSV data
        async function loadMusicData() {
            try {
                const response = await fetch('music_library.csv');
                const text = await response.text();
                
                // Parse CSV
                const rows = text.split('\n').slice(1); // Skip header
                musicData = rows
                    .filter(row => row.trim())
                    .map(row => {
						const [artist, title, length, album, albumArtist, disc, track] = parseCSVRow(row);
						return { artist, title, length, album, albumArtist, disc: parseInt(disc) || 1, track: parseInt(track) || 0 };
                    });
                
				sortMusicData();
				
                filteredData = [...musicData];
                updateDisplay();
                updateInfo();
            } catch (error) {
                document.getElementById('tableBody').innerHTML = 
                    '<tr><td colspan="3" class="no-results">Error loading music library. Make sure music_library.csv is in the same directory.</td></tr>';
            }
        }

		// Sort music data
		function sortMusicData() {
			musicData.sort((a, b) => {
				// Sort by Album first
				if (a.album !== b.album) {
					return a.album.localeCompare(b.album);
				}
				// Then by Disc
				if (a.disc !== b.disc) {
					return a.disc - b.disc;
				}
				// Then by Track
				if (a.track !== b.track) {
					return a.track - b.track;
				}
				// Finally by Title
				return a.title.localeCompare(b.title);
			});
		}

        // Parse CSV row handling quoted fields
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result;
        }

        // Filter data based on search
        function filterData(searchTerm) {
            const term = searchTerm.toLowerCase();
            
            if (!term) {
                filteredData = [...musicData];
            } else {
				filteredData = musicData.filter(track => 
					track.artist.toLowerCase().includes(term) ||
					track.title.toLowerCase().includes(term) ||
					track.length.toLowerCase().includes(term) ||
					track.album.toLowerCase().includes(term) ||
					track.albumArtist.toLowerCase().includes(term)
				);
            }
            
            updateDisplay();
            updateInfo();
        }

        // Update table display
        function updateDisplay() {
            const tbody = document.getElementById('tableBody');
            
            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="no-results">No results found</td></tr>';
                return;
            }
            
            tbody.innerHTML = filteredData
                .map(track => `
                    <tr>
                        <td>${escapeHtml(track.artist)}</td>
                        <td>${escapeHtml(track.title)}</td>
                        <td>${escapeHtml(track.length)}</td>
                    </tr>
                `)
                .join('');
        }

        // Update info text
        function updateInfo() {
            const info = document.getElementById('info');
            const showing = filteredData.length;
            const total = musicData.length;
            
            if (showing === total) {
                info.textContent = `Showing ${total.toLocaleString()} tracks`;
            } else {
                info.textContent = `Showing ${showing.toLocaleString()} of ${total.toLocaleString()} tracks`;
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Search input handler
        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterData(e.target.value);
        });

        // Load data on page load
        loadMusicData();
    </script>
</body>
</html>